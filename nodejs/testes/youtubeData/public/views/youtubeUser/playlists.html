<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listando PlayList</title>
    <style>
        body {
            background-color: #191919;
            color: white;
        }

        .c-auth {
            position: absolute;
            top: 15px;
            right: 20px;

            padding: 5px;
            border-radius: 5px;
            box-shadow: 2px 2px 5px azure;
            background-color: #191919;
            color: aliceblue;
        }
        button {
            background-color: #191919;
            color: aliceblue;
            border: none;
            padding: 5px;
        }

        a {
            color: inherit;
            text-decoration: none;
            outline: none;
        }

        .count {
            color: blueviolet;
        }
        #content {
            width: 1000px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .card {
            box-shadow: 1px 1px 5px wheat;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .voltar {
            width: 25px;
            height: 25px;
            border-radius: 5px;
            padding: 3px;
            background-color: #999;

            font-weight: bold;
            margin-left: 40px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Listando Playlist do Youtube</h1>
    <button class="voltar" onclick="window.history.back()"><</button>

    <div class="c-auth">
        <button>
            <a href="/v3/logout">LOGUOT</a>
        </button>
    </div>

    <div id="content">
        <div id="videos"></div>
    </div>

    <script type="module">
        let playlistsCache = null;

        async function fetchPlaylists() {
            if (playlistsCache) {
                return playlistsCache;
            }

            const res = await fetch("http://localhost:3001/ytlist");
            const data = await res.json();

            playlistsCache = data; 
            return data;
        }
       
        function renderPlaylists(playlists) {
            const container = document.getElementById("videos");
            container.innerHTML = "";

            playlists.forEach(p => {
                const card = document.createElement("div");
                card.className = "card";
                card.dataset.playlistId = p.id;

                card.innerHTML = `
                <img src="${p.thumbnailList}" alt="${p.title}">
                <h3>${p.title}</h3>
                <button class="btn-playlist">Ver playlist</button>
                `;

                container.appendChild(card);
            })
        }
        function renderVideos(playlistId) {
            const playlist = playlistsCache.find(p => p.id === playlistId);
            if (!playlist) return;

            const container = document.getElementById("videos");
            container.innerHTML = "";

            playlist.videos.forEach(v => {
                const card = document.createElement("div");
                card.className = "card";

                card.innerHTML = `
                <img src="${v.thumbnail}" alt="${v.title}">
                <h3>${v.title}</h3>
                <a href="${v.url}" target="_blank">Assistir</a>
                `;

                container.appendChild(card);
            })
        }
        document.getElementById("videos").addEventListener("click", (e) => {
            if (!e.target.classList.contains("btn-playlist")) return;

            const playlistId = e.target
                .closest(".card")
                .dataset.playlistId;

            renderVideos(playlistId);
        })
        // document.getElementById("btn-voltar").addEventListener("click", () => {
        //     renderPlaylists(playlistsCache);
        // })


        // async function PlayList() {

        //     const req = await fetch(`http://localhost:3001/ytlist`)
        //     const data = await req.json()
        //     // console.log(data[2])
        //     return data
        // }

        // function renderPlaylists(playlists) {
        //     const container = document.getElementById("videos");
        //     container.innerHTML = "";

        //     playlists.forEach(p => {
        //         const card = document.createElement("div");
        //         card.className = "card";
        //         card.dataset.playlistId = p.id;

        //         card.innerHTML = `
        //         <img src="${p.thumbnailList}" alt="${p.title}">
        //         <h3>${p.title}</h3>
        //         <button class="btn-playlist">Ver playlist</button>
        //         `;

        //         container.appendChild(card);
        //     })
        // }
        // function renderVideos(playlist) {
        //     const container = document.getElementById("videos");
        //     container.innerHTML = "";

        //     playlist.videos.forEach(v => {
        //         const card = document.createElement("div");
        //         card.className = "card";

        //         card.innerHTML = `
        //         <img src="${v.thumbnail}" alt="${v.title}">
        //         <h3>${v.title}</h3>
        //         <a href="${v.url}" target="_blank">Assistir</a>
        //         `;

        //         container.appendChild(card);
        //     })
        // }

        // document.getElementById("videos").addEventListener("click", async (e) => {
        //     if (!e.target.classList.contains("btn-playlist")) return;

        //     const playlistId = e.target
        //         .closest(".card")
        //         .dataset.playlistId;

        //     const playlists = await PlayList();
        //     const selected = playlists.find(p => p.id === playlistId);

        //     if (selected) {
        //         renderVideos(selected);
        //     }
        // })

        // const playlists = await PlayList();
        // renderPlaylists(playlists);

        // const p = await PlayList()
        // console.log(p)

        // async function cardVideos(p) {
        //     document.getElementById('videos').innerHTML = ''

        //     const card = document.createElement('section')

        //     card.innerHTML = p.map(i => {
        //         return `
        //             <div class="card" data-idvideo="${i.id}">
        //                 <img src="${i.thumbnailList}" alt="${i.title}">
        //                 <h3>${i.title}</h3>
        //                 <button id='list-id-${i.id}'>ver playlist</button>
        //             </div>
        //         `

        //    }).join("")


        //    document.getElementById('videos').append(card)

        // //    if (!document.getElementById('list-videos')) return

        //    listVideos(p)
        // }

        // cardVideos(p)

        // function listVideos(p) {
        //     const idvideo = document.querySelector('[data-idvideo]').dataset
        //     console.log(idvideo);
            
        //     document.getElementById(`list-id-${idvideo}`).addEventListener('click', async () => {
        //         document.getElementById('videos').innerHTML = ''
        //          const p = await PlayList()
        //         console.log(p);

        //         const card = document.createElement('section')

        //         card.innerHTML = p[7].videos.map(i => {
        //             return `
        //                 <div class="card" data-idvideo="${i.videoId}">
        //                     <img src="${i.thumbnail}" alt="${i.title}">
        //                     <h3>${i.title}</h3>
        //                     <a href="${i.url}" target="_blank">Assistir</a>
        //                 </div>
        //             `
        //     }).join("")


        //     document.getElementById('videos').append(card)
        //     })
        // }
    </script>
</body>
</html>
